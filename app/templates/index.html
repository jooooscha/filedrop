<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="Simple file drop server.">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
    <title>Filedrop</title>
    <style>
        #drop_zone {
            border: 3px dashed gray;
            width: 100%;
            height: 200px;
        }

        .drop-zone-text {
            text-align: center;
            position: relative;
            top: 50%;
            transform: translateY(-50%);
        }

        .center {
            text-align: center;
        }
    </style>
</head>
<body>
<main class="container">
    <article>
        <div class="container">
            <div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);"
                 onclick="openFileSelector();">
                <p class="drop-zone-text">Drag files here</p>
            </div>
            <input type="file" id="file_selector" name="files" accept="image/*" multiple required>
        </div>
        <br>
        <progress hidden id="progress" value="25" max="100"></progress>
        <br>
        <button onclick="uploadFiles()">Upload</button>
    </article>
</main>
</body>

<script>
    function dropHandler(ev) {
        console.log('File(s) dropped');
        ev.preventDefault();

        if (ev.dataTransfer.items) {
            [...ev.dataTransfer.items].forEach((item, i) => {
                if (item.kind === 'file') {
                    const file = item.getAsFile();
                    console.log(`… file[${i}].name = ${file.name}`);
                }
            });
        } else {
            [...ev.dataTransfer.files].forEach((file, i) => {
                console.log(`… file[${i}].name = ${file.name}`);
            });
        }

        // add files to file_selector
        document.getElementById('file_selector').files = ev.dataTransfer.files;
    }

    function dragOverHandler(ev) {
        ev.preventDefault();
    }

    function openFileSelector() {
        document.getElementById('file-selector').click();
    }

    function uploadFiles() {
        // abort if files is empty
        if (document.getElementById('file_selector').files.length === 0) {
            return;
        }

        // upload files from "file_selector" to "/upload" via post
        // show progress in the porogress bar

        // make formDate object
        const formData = new FormData();
        [...document.getElementById('file_selector').files].forEach((file, i) => {
            console.log(file)
            formData.append(`file${i}`, file);
        });

        // make request
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/upload');
        // show progressbar
        document.querySelector('#progress').hidden = false;
        xhr.upload.onprogress = function (e) {
            if (e.lengthComputable) {
                const percentComplete = (e.loaded / e.total) * 100;
                console.log(percentComplete);
                document.querySelector('#progress').value = percentComplete;
            }
        };

        xhr.onload = function () {
            if (this.status === 200) {
                console.log('Upload complete');
                const buttonColor = document.querySelector('button').style.backgroundColor;
                document.querySelector('button').style.backgroundColor = 'green';
                document.querySelector('button').innerText = 'Uploaded!';
                setTimeout(() => {
                    document.querySelector('button').style.backgroundColor = buttonColor;
                    document.querySelector('button').innerText = 'Upload';
                }, 3000);
            } else {
                console.error('Upload failed');
            }

            // hide and reset progressbar
            document.querySelector('#progress').hidden = true;
            document.querySelector('#progress').value = 0;

            // reset file_selector
            document.getElementById('file_selector').value = '';
        };

        console.log(formData);
        xhr.send(formData);
    }
</script>

</html>
<!-- <!doctype html> -->
<!-- <html lang="en"> -->
<!-- <head> -->
<!--     [> Required meta tags <] -->
<!--     <meta charset="utf-8"> -->
<!--     <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> -->

<!--     [> Bootstrap CSS <] -->
<!--     <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"> -->

<!--     [> Custom Styles <] -->
<!--     <style> -->
<!--         body { -->
<!--             background-color: #f8f9fa; -->
<!--         } -->
<!--         .container { -->
<!--             max-width: 800px; -->
<!--             margin-top: 50px; -->
<!--             padding: 20px; -->
<!--             background-color: #ffffff; -->
<!--             border-radius: 10px; -->
<!--             box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1); -->
<!--         } -->
<!--         h1 { -->
<!--             font-size: 2rem; -->
<!--             margin-bottom: 20px; -->
<!--         } -->
<!--         .custom-file-label::after { -->
<!--             content: "Browse"; -->
<!--         } -->
<!--         /* Loading Screen Styles */ -->
<!--         .loading-overlay { -->
<!--             position: fixed; -->
<!--             top: 0; -->
<!--             left: 0; -->
<!--             width: 100%; -->
<!--             height: 100%; -->
<!--             background: rgba(0, 0, 0, 0.5); -->
<!--             justify-content: center; -->
<!--             align-items: center; -->
<!--             z-index: 1000; -->
<!--         } -->
<!--         .loading-spinner { -->
<!--             border: 16px solid #f3f3f3; /* Light grey */ -->
<!--             border-top: 16px solid #3498db; /* Blue */ -->
<!--             border-radius: 50%; -->
<!--             width: 120px; -->
<!--             height: 120px; -->
<!--             animation: spin 2s linear infinite; -->
<!--         } -->
<!--         @keyframes spin { -->
<!--             0% { transform: rotate(0deg); } -->
<!--             100% { transform: rotate(360deg); } -->
<!--         } -->
<!--     </style> -->

<!--     <title>Upload Photos</title> -->
<!-- </head> -->
<!-- <body> -->
<!--     <div class="container"> -->
<!--         <h1 class="text-center">Upload Photos</h1> -->
<!--         <form id="uploadForm" method="POST" action="/upload" enctype="multipart/form-data"> -->
<!--             <div class="custom-file mb-3"> -->
<!--                 <input type="file" class="custom-file-input" id="file" name="files" accept="image/*" multiple required> -->
<!--                 <label class="custom-file-label" for="file">Choose files</label> -->
<!--             </div> -->
<!--             <button type="submit" class="btn btn-primary btn-block">Upload</button> -->
<!--         </form> -->
<!--     </div> -->

<!--     [> Loading Screen <] -->
<!--     <div class="loading-overlay" id="loadingOverlay"> -->
<!--         <div class="loading-spinner"></div> -->
<!--     </div> -->

<!--     [> Optional JavaScript; choose one of the two! <] -->

<!--     [> Option 1: jQuery and Bootstrap Bundle (includes Popper) <] -->
<!--     <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script> -->
<!--     <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script> -->
<!--     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script> -->

<!--     [> Script to show the number of files in the input field <] -->
<!--     <script> -->
<!--         $("#file").on("change", function() { -->
<!--             var files = $(this)[0].files; -->
<!--             var fileCount = files.length; -->
<!--             var label = fileCount + " file(s) selected"; -->
<!--             $(this).siblings(".custom-file-label").addClass("selected").html(label); -->
<!--         }); -->

<!--         // Show loading screen when form is submitted -->
<!--         $("#uploadForm").on("submit", function() { -->
<!--             $("#loadingOverlay").show(); -->
<!--         }); -->
<!--     </script> -->
<!-- </body> -->
<!-- </html> -->
